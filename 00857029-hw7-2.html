<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>Local Storage</title>
    <style type="text/CSS">
        table {
            width: 90%;
            border-collapse: collapse;
            background-color: lightblue;
            font-family: Perpetua;
        }

        table, td, th {
            border: 1px solid black;
            padding: 4px;
        }

        th {
            text-align: center;
            color: white;
            background-color: darkblue;
        }

        tr.oddrow {
            background-color: white;
        }

        td {
            text-align: center;
        }
    </style>
    <script type="text/javascript">
    
        function addData(){
            console.log(1)
            d=new Date()
            key="ntou-"+Date.now();
            const book={
                title:document.getElementById("title").value,
                author:document.getElementById("author").value,
                year:document.getElementById("year").value,
                url:document.getElementById("url").value
            }
            // book.title=document.getElementById("title").value;
            // book.author=document.getElementById("author").value;
            // book.year=document.getElementById("year").value;
            // book.url=document.getElementById("url").value;
            value=JSON.stringify(book);
            localStorage.setItem(key,value);
            loadTable();
        }
        function loadTable(){
            divadd="";
            divadd+= "<table>" +"<thead><tr><th>Title</th>"+ "<th>Author</th>" +"<th>Year</th>"+"<th>URL</th>"+"</tr></thead><tbody>" 
                num=localStorage.length
                tag=[]
                for(j=0;j<num;j++){
                    if(localStorage.key(j).startsWith("ntou-")){
                        tag[j]=localStorage.getItem(localStorage.key(j))
                    }
                }
                tag.sort()
                for(i=0;i<num;i++){
                    divadd+="<tr>"
                    if(localStorage.key(i).startsWith("ntou-")){
                        book=JSON.parse(tag[i])
                        console.log(book['title'])
                        divadd+="<td>"+book['title']+"</td>"
                        divadd+="<td>"+book['author']+"</td>"
                        divadd+="<td>"+book['year']+"</td>"
                        divadd+="<td><a href=\'"+book['url']+"\' target='_blank'>"+book['url']+"</td>"
                    }
                    divadd+="</tr>"
                }
                //     document.writeln( "<table>" ); // begin the table
        //  document.writeln( 
        //     "<caption>Calculating Compound Interest</caption>" );
        //  document.writeln( 
        //     "<thead><tr><th>Year</th>" ); // year column heading
        //  document.writeln(
        //     "<th>Amount on deposit</th>" ); // amount column heading
        //  document.writeln( "</tr></thead><tbody>" );
        //     for ( var year = 1; year <= 10; ++year )
        //  {
        //     amount = principal * Math.pow( 1.0 + rate, year );

        //     if ( year % 2 !== 0 )
        //        document.writeln( "<tr class='oddrow'><td>" + year + 
        //           "</td><td>" + amount.toFixed(2) + "</td></tr>" );
        //     else
        //        document.writeln( "<tr><td>" + year + 
        //           "</td><td>" + amount.toFixed(2) + "</td></tr>" );
        //  } //end for

        //  document.writeln( "</tbody></table>" );
         document.getElementById("display").innerHTML=divadd;
        }
        function clearall(){
            console.log(1)
            num=localStorage.length
            console.log(num)
            for(i=0;i<num; ){
                console.log(localStorage.key(i))
                if(localStorage.key(i)!=null){
                    if(localStorage.key(i).startsWith("ntou-")){
                localStorage.removeItem(localStorage.key(i))
                }
                // console.log(localStorage.key(i).startsWith("ntou-"))
                
            }else{
                i++
            }
            }
            window.alert('All items are remove!')
            loadTable()
        }
       
    </script>
</head>

<body>
    <form action="#">
        <p>
            <label>Book Title:<input type="text" id="title"></label>
            <label>Author(s):<input type="text" id="author"></label>
            <label>Year:<input type="number" id ='year'></label>
            <label>Book URL:<input type="url" id ='url'></label>
        </p>
        <p>
            <input type="button" value="Add New Item" id="addButton" onclick="addData()">
            <input type="button" value="Remove All Items" id="removeAllButton" onclick="clearall()">
        </p>
    </form>
    <hr>
    <div id="display">
    </div>
</body>
<script>
    loadTable()
     function clear(){
        console.log(1)
            num=localStorage.length
            console.log(num)
            for( i=0;i<num;i++){
                console.log(localStorage.key(i))
                console.log(localStorage.key(i).startsWith("ntou-"))
                if(localStorage.key(i).startsWith("ntou-"))
                localStorage.removeItem(localStorage.key(i))
            }
            
        }
</script>
</html>